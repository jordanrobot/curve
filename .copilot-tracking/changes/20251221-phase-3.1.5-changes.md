<!-- markdownlint-disable-file -->
# Release Changes: Phase 3.1.5 Implementation

**Related Plan**: .github/planning/phase-3.1.5-plan.md
**Implementation Date**: 2025-12-21

## Summary

Implemented shared-axis JSON persistence with DTO mapping, validation hardening, lightweight probing, and schema/docs updates for the series table/map format; finalized plan/tasks and preserved series ordering during round-trips.

## Changes

### Added

- src/CurveEditor/AssemblyInfo.cs - Exposes internals to test assembly for DTO/mapping coverage.
- src/CurveEditor/MotorDefinitions/Dtos/MotorDefinitionFileDto.cs - DTO for persisted motor definition root object.
- src/CurveEditor/MotorDefinitions/Dtos/DriveFileDto.cs - DTO for drive entries with ordered properties.
- src/CurveEditor/MotorDefinitions/Dtos/VoltageFileDto.cs - DTO capturing shared percent/rpm axes and series map.
- src/CurveEditor/MotorDefinitions/Dtos/SeriesEntryDto.cs - DTO for per-series torque data and metadata.
- src/CurveEditor/MotorDefinitions/Dtos/UnitSettingsDto.cs - DTO for persisted unit settings including new units.
- src/CurveEditor/MotorDefinitions/Dtos/MotorMetadataDto.cs - DTO for persisted metadata values.
- src/CurveEditor/MotorDefinitions/Mapping/MotorFileMapper.cs - Mapping between DTOs and runtime models.
- src/CurveEditor/MotorDefinitions/Validation/MotorFileShapeValidator.cs - Shape validation for shared axes.
- src/CurveEditor/MotorDefinitions/Probing/MotorFileProbe.cs - Lightweight JsonDocument-based motor probe.
- tests/CurveEditor.Tests/MotorDefinitions/MotorFileMapperTests.cs - Round-trip and failure coverage for mapper.
- tests/CurveEditor.Tests/Services/MotorFileSizeBenchmarkTests.cs - Benchmark verifying new format size savings.

### Modified

- schema/motor-schema-v1.0.0.json - Reworked schema for shared axes, series map, and new properties/units with length constraints.
- schema/example-motor.json - Regenerated example using series table/map format and new properties.
- src/CurveEditor/Models/MotorDefinition.cs - Added brake response/engage/backlash properties.
- src/CurveEditor/Models/UnitSettings.cs - Added responseTime, percentage, temperature defaults and labels.
- src/CurveEditor/Models/VoltageConfiguration.cs - Case-sensitive series lookup and shared-axis helpers.
- src/CurveEditor/Services/FileService.cs - Switched to DTO-based persistence with mapper/validation integration and deterministic emission.
- src/CurveEditor/Services/ValidationService.cs - Enforced shared-axis semantics and new property validation.
- src/CurveEditor/ViewModels/DirectoryBrowserViewModel.cs - Adopted JsonDocument probe for lightweight motor detection.
- tests/CurveEditor.Tests/Models/VoltageConfigurationTests.cs - Adjusted expectations for case-sensitive series map behavior.
- tests/CurveEditor.Tests/Services/FileServiceTests.cs - Updated round-trip coverage for new format and metadata.
- tests/CurveEditor.Tests/Services/ValidationServiceTests.cs - Added axis and brake validation failure cases.
- tests/CurveEditor.Tests/ViewModels/DirectoryBrowserInteractionTests.cs - Updated fixtures to new persisted shape.
- tests/CurveEditor.Tests/ViewModels/MainWindowDirectoryBrowserSyncTests.cs - Synced fixtures to new format for selection sync.
- tests/CurveEditor.Tests/ViewModels/MainWindowDirectoryBrowserDirtyOpenTests.cs - Synced fixtures and prompts with new format.
- .github/planning/phase-3.1.5-plan.md - Marked Phase 3.1.5 scope/tasks/ACs complete.
- .github/planning/phase-3.1.5-tasks.md - Checked off execution checklist and acceptance criteria.

### Removed

- None.

## Release Summary

**Total Files Affected**: 28

### Files Created (12)

- src/CurveEditor/AssemblyInfo.cs - InternalsVisibleTo for tests.
- src/CurveEditor/MotorDefinitions/Dtos/MotorDefinitionFileDto.cs - Motor root DTO.
- src/CurveEditor/MotorDefinitions/Dtos/DriveFileDto.cs - Drive DTO with seriesName ordering.
- src/CurveEditor/MotorDefinitions/Dtos/VoltageFileDto.cs - Voltage DTO with shared axes and series map.
- src/CurveEditor/MotorDefinitions/Dtos/SeriesEntryDto.cs - Series torque/metadata DTO.
- src/CurveEditor/MotorDefinitions/Dtos/UnitSettingsDto.cs - Units DTO with new defaults.
- src/CurveEditor/MotorDefinitions/Dtos/MotorMetadataDto.cs - Metadata DTO.
- src/CurveEditor/MotorDefinitions/Mapping/MotorFileMapper.cs - Runtime/DTO mapper.
- src/CurveEditor/MotorDefinitions/Validation/MotorFileShapeValidator.cs - DTO shape validation.
- src/CurveEditor/MotorDefinitions/Probing/MotorFileProbe.cs - Lightweight motor file probe.
- tests/CurveEditor.Tests/MotorDefinitions/MotorFileMapperTests.cs - Mapper round-trip tests.
- tests/CurveEditor.Tests/Services/MotorFileSizeBenchmarkTests.cs - Size benchmark test for new format.

### Files Modified (16)

- schema/motor-schema-v1.0.0.json - Updated schema to series map format with new properties/units.
- schema/example-motor.json - Example regenerated for new format and defaults.
- src/CurveEditor/Models/MotorDefinition.cs - Added brake timings/backlash properties.
- src/CurveEditor/Models/UnitSettings.cs - Added new unit labels/defaults including response time.
- src/CurveEditor/Models/VoltageConfiguration.cs - Case-sensitive series helpers and shared-axis utilities.
- src/CurveEditor/Services/FileService.cs - Persisted via DTO mapper with validation and deterministic ordering.
- src/CurveEditor/Services/ValidationService.cs - Added axis monotonicity/length checks and brake validation.
- src/CurveEditor/ViewModels/DirectoryBrowserViewModel.cs - Probes JSON shape via MotorFileProbe for lightweight filtering.
- tests/CurveEditor.Tests/Models/VoltageConfigurationTests.cs - Adjusted expectations for case-sensitive lookups.
- tests/CurveEditor.Tests/Services/FileServiceTests.cs - Round-trip tests for series map persistence.
- tests/CurveEditor.Tests/Services/ValidationServiceTests.cs - Failure cases for invalid axes/arrays.
- tests/CurveEditor.Tests/ViewModels/DirectoryBrowserInteractionTests.cs - Fixtures updated to new JSON shape.
- tests/CurveEditor.Tests/ViewModels/MainWindowDirectoryBrowserSyncTests.cs - Selection sync tests updated to new format.
- tests/CurveEditor.Tests/ViewModels/MainWindowDirectoryBrowserDirtyOpenTests.cs - Dirty open tests updated for new format.
- .github/planning/phase-3.1.5-plan.md - Marked phase completion and acceptance.
- .github/planning/phase-3.1.5-tasks.md - Execution checklist marked complete.

### Files Removed (0)

- None.

### Dependencies & Infrastructure

- **New Dependencies**: None
- **Updated Dependencies**: None
- **Infrastructure Changes**: None
- **Configuration Updates**: None

### Deployment Notes

None.
