## Phase 3.7 Subtasks: Rename objects for clarity (Agent Execution Checklist)

### Purpose
- Provide a PR-sliceable task list for implementing Phase 3.7 with minimal rework.
- Make it easy for agents to validate each acceptance criterion incrementally.

### Execution Rules (Mandatory)

- Treat this file as the single source of truth for work tracking.
- Do not start a PR section until the prior PR section is complete.
- When a task is completed, mark it as `[x]` immediately.
- A PR section is not complete until:
  - All tasks are checked `[x]`, AND
  - The "Done when" criteria are satisfied.
- Do not add “nice-to-haves” that are not listed in this file or the phase requirements.

### Scope Reminder (Phase 3.7)
- Rename the core domain types throughout the repo:
  - `MotorDefinition` -> `ServoMotor`
  - `CurveSeries` -> `Curve`
  - `DriveConfiguration` -> `Drive`
  - `VoltageConfiguration` -> `Voltage`
- Rename key collection properties accordingly:
  - `MotorDefinition.DriveConfigurations` -> `ServoMotor.Drives`
  - `DriveConfiguration.VoltageConfigurations` -> `Drive.Voltages`
  - `VoltageConfiguration.CurveSeries` -> `Voltage.Curves`
- Update all related docs and unit tests.

Do not implement out-of-scope Phase 3.7 items.

### Key Files (Expected touch points)

Domain model (library):
- `src/MotorDefinition/Models/MotorDefinition.cs`
- `src/MotorDefinition/Models/CurveSeries.cs`
- `src/MotorDefinition/Models/DriveConfiguration.cs`
- `src/MotorDefinition/Models/VoltageConfiguration.cs`

Persistence/mapping/validation (library + editor):
- `src/MotorDefinition/MotorDefinitions/Mapping/MotorFileMapper.cs`
- `src/MotorDefinition/Persistence/Dtos/*`
- `src/MotorEditor.Avalonia/Services/ValidationService.cs`

Editor (Avalonia):
- `src/MotorEditor.Avalonia/ViewModels/MainWindowViewModel.cs`
- `src/MotorEditor.Avalonia/ViewModels/ChartViewModel.cs`
- `src/MotorEditor.Avalonia/ViewModels/CurveDataTableViewModel.cs`
- `src/MotorEditor.Avalonia/ViewModels/EditingCoordinator.cs`
- `src/MotorEditor.Avalonia/Views/CurveDataPanel.axaml.cs`
- `src/MotorEditor.Avalonia/Services/EditMotorPropertyCommand.cs` (contains drive/voltage edit commands too)

Tests:
- `tests/CurveEditor.Tests/*`

Docs:
- `README.md`
- `docs/*`


### Acceptance Criteria (Phase 3.7)

- AC 3.7.1: No remaining references to the old domain type names (`MotorDefinition`, `CurveSeries`, `DriveConfiguration`, `VoltageConfiguration`) except any explicitly chosen compatibility shims.
- AC 3.7.2: `src/MotorDefinition` builds and continues to load/save motor JSON files without schema changes.
- AC 3.7.3: `src/MotorEditor.Avalonia` builds and the app can open an existing file and show curves.
- AC 3.7.4: All unit tests pass.
- AC 3.7.5: `docs/` and `README.md` reflect the new terminology.

### State Model Summary (Target)

- Runtime state:
  - Domain graph reads naturally: `ServoMotor.Drives[*].Voltages[*].Curves[*].Data[*]`.
  - Undo/redo reflection-based edits continue to work (property-name strings stay aligned).
- Persistence:
  - No JSON schema/shape changes (ADR-0006). CLR type renames must not alter serialized property names.

Defaults (first run / no persisted state):
- N/A (rename-only phase; existing behaviors unchanged).

### Assumptions and Constraints

- Decision: use `ServoMotor` as the top-level type name; future support for multiple motor types is out of scope.
- This phase is primarily mechanical rename + reference updates; avoid incidental functional changes.
- Backward compatibility shims are NOT required by default. If needed, introduce them explicitly and document them (do not silently keep both names in active use).
- `docs/api/*` is generated by a NuGet package; do not hand-edit these files. Keep XML documentation comments correct so regenerated API docs stay consistent.

### Agent Notes (Migration Guidance)

- Compile-first strategy: rename in the model library first, then propagate into mapping/services/editor/tests/docs.
- The editor uses undoable commands that reference properties via `nameof(...)` and may use reflection-based property setters; these are the highest-risk breakpoints during renaming.
- The existing model already exposes bridge properties:
  - `MotorDefinition.DriveConfigurations => Drives`
  - `DriveConfiguration.VoltageConfigurations => Voltages`
  Decide whether to remove, rename, or temporarily keep equivalents in a single, deliberate step.

### Implementation Notes (to avoid known pitfalls)

- Do not change JSON property names/attributes while renaming CLR types.
- Avoid reformatting and unrelated refactors; keep diffs reviewable.
- Ensure XML doc comments are updated for renamed types/members.

---

## [ ] PR 0: Preparation (no behavior change)

### Goal
Establish guardrails and an inventory so the rename can proceed with minimal surprises.

### Tasks
- [ ] Create a rename inventory checklist (quick searches):
  - [ ] Find all references to: `MotorDefinition`, `CurveSeries`, `DriveConfiguration`, `VoltageConfiguration`.
  - [ ] Find reflection/property-name usage that could break:
    - [ ] `nameof(MotorDefinition.*)` / `nameof(DriveConfiguration.*)` / etc.
    - [ ] `GetProperty(` / `PropertyInfo` usage in edit commands.
- [ ] Decide compatibility posture (record in PR description and/or this file):
  - [ ] No shims (default), OR
  - [ ] Add `[Obsolete]` wrappers (explicitly listed if chosen).
- [ ] Decide how to treat `docs/api/*` in this repo:
  - [ ] Generated and checked in (regenerate later), OR
  - [ ] Authored and maintained manually (rename/update links later).

Required hygiene:
- [ ] Ensure no user-visible behavior changes in this PR.

### Done when
- Rename inventory exists (as PR notes or checklist updates).
- Build remains green.

### Files
- `.github/planning/phase-3.7-tasks.md`

### Quick manual test
1. Build the solution.
2. Launch the app and open a known-good JSON file (no behavior changes expected).

---

## [ ] PR 1: Rename domain model types in `src/MotorDefinition` (compile-first)

### Goal
Rename the core domain types and their primary collections so the domain graph reads clearly.

### Tasks
- [ ] Rename files + types:
  - [ ] `MotorDefinition` -> `ServoMotor` (and `MotorDefinition.cs` -> `ServoMotor.cs`)
  - [ ] `CurveSeries` -> `Curve` (and `CurveSeries.cs` -> `Curve.cs`)
  - [ ] `DriveConfiguration` -> `Drive` (and `DriveConfiguration.cs` -> `Drive.cs`)
  - [ ] `VoltageConfiguration` -> `Voltage` (and `VoltageConfiguration.cs` -> `Voltage.cs`)
- [ ] Rename core collections:
  - [ ] `ServoMotor.Drives`
  - [ ] `Drive.Voltages`
  - [ ] `Voltage.Curves`
- [ ] Decide and implement bridge strategy (single choice; don’t leave ambiguous duplication):
  - [ ] Remove bridge properties, OR
  - [ ] Rename bridges to match new types (e.g., `ServoMotor.DriveConfigurations` as `[Obsolete]` forwarding to `Drives`) if compatibility is explicitly desired.
- [ ] Update XML docs / `<see cref="..."/>` references in these model files.
- [ ] Ensure XML documentation comments (type/member summaries, param names, `<see cref>` targets) use the new identifiers.

Required hygiene:
- [ ] Keep JSON attributes intact; do not change serialization behavior.

### Done when
- `src/MotorDefinition/MotorDefinition.csproj` builds.
- No schema changes required to load/save existing JSON.

### Files
- `src/MotorDefinition/Models/ServoMotor.cs`
- `src/MotorDefinition/Models/Curve.cs`
- `src/MotorDefinition/Models/Drive.cs`
- `src/MotorDefinition/Models/Voltage.cs`
- Any impacted model-adjacent files due to type name changes.

### Quick manual test
1. Build `src/MotorDefinition`.
2. Run a quick load/save round-trip on an existing motor JSON via existing unit tests or a small harness (no behavioral changes expected).

---

## [ ] PR 2: Update mapping/persistence/probing/validation for renamed types

### Goal
Make persistence and validation layers compile and behave identically with the renamed CLR types.

### Tasks
- [ ] Update mapping layer to use new identifiers:
  - [ ] `src/MotorDefinition/MotorDefinitions/Mapping/MotorFileMapper.cs`
  - [ ] Any other mapping/probing classes under `src/MotorDefinition/MotorDefinitions/*`
- [ ] Update DTO conversion code and any references under:
  - [ ] `src/MotorDefinition/Persistence/Dtos/*`
- [ ] Update validation logic impacted by type rename:
  - [ ] `src/MotorEditor.Avalonia/Services/ValidationService.cs` (and interfaces)
- [ ] Verify no schema changes:
  - [ ] Ensure property names/JSON attributes still match existing schema.
  - [ ] Ensure any string-based lookups are not keyed on CLR type names.

Required hygiene:
- [ ] Add/adjust unit tests only if required to detect a subtle regression (e.g., reflection-driven mapping).

### Done when
- `src/MotorDefinition` builds.
- Existing load/save tests (or equivalent) pass.

### Files
- `src/MotorDefinition/MotorDefinitions/Mapping/MotorFileMapper.cs`
- `src/MotorDefinition/MotorDefinitions/Probing/*`
- `src/MotorDefinition/Persistence/Dtos/*`
- `src/MotorEditor.Avalonia/Services/ValidationService.cs`

### Quick manual test
1. Open `schema/example-motor.json` in the app and verify it loads.
2. Save to a new file and verify it remains schema-compatible.

---

## [ ] PR 3: Update editor (Avalonia) references + undo/redo command safety

### Goal
Update the UI/editor layer to the renamed types while preserving undo/redo and selection coordination.

### Tasks
- [ ] Update view models to compile with new names:
  - [ ] `MainWindowViewModel` (selected motor/drive/voltage/curve state)
  - [ ] `ChartViewModel` (series/curve rendering)
  - [ ] `CurveDataTableViewModel` (columns/rows and curve selection)
  - [ ] `EditingCoordinator` (selection record types)
- [ ] Update view code-behind and data contexts:
  - [ ] `CurveDataPanel.axaml.cs`
  - [ ] Any other views binding to `CurveSeries`/`VoltageConfiguration` etc.
- [ ] Harden reflection-based edit commands:
  - [ ] Update any `nameof(OldType.Property)` usages.
  - [ ] Verify reflection setters still find the property names they expect after renaming.
  - [ ] Ensure error messages/logging still make sense after rename.
- [ ] Update XML documentation comments in touched files so references/readability match the new names.

Required hygiene:
- [ ] Do not change UX behavior; only update identifiers.

### Done when
- `src/MotorEditor.Avalonia/MotorEditor.Avalonia.csproj` builds.
- App can open an existing JSON file and display curves.
- Undo/redo still works for at least one motor property edit and one curve-table edit.

### Files
- `src/MotorEditor.Avalonia/ViewModels/MainWindowViewModel.cs`
- `src/MotorEditor.Avalonia/ViewModels/ChartViewModel.cs`
- `src/MotorEditor.Avalonia/ViewModels/CurveDataTableViewModel.cs`
- `src/MotorEditor.Avalonia/ViewModels/EditingCoordinator.cs`
- `src/MotorEditor.Avalonia/Views/CurveDataPanel.axaml.cs`
- `src/MotorEditor.Avalonia/Services/EditMotorPropertyCommand.cs`

### Quick manual test
1. Launch app.
2. Open existing motor JSON.
3. Rename a motor property; press Ctrl+Z / Ctrl+Y.
4. Edit a torque cell; press Ctrl+Z / Ctrl+Y.

---

## [ ] PR 4: Update unit tests and helpers

### Goal
Restore all tests to green with the new naming.

### Tasks
- [ ] Update test code to use new types and member names:
  - [ ] Replace `MotorDefinition` with `ServoMotor`
  - [ ] Replace `CurveSeries` with `Curve`
  - [ ] Replace `DriveConfiguration` with `Drive`
  - [ ] Replace `VoltageConfiguration` with `Voltage`
  - [ ] Update any builders/fixtures that create model graphs.
- [ ] Rename test files/classes where it improves clarity and avoids confusion.
- [ ] Add a targeted regression test ONLY if needed:
  - [ ] Example: verify an `Edit*PropertyCommand` still sets a property via reflection after rename.

### Done when
- `dotnet test` passes.

### Files
- `tests/CurveEditor.Tests/*`

### Quick manual test
1. Run `dotnet test`.

---

## [ ] PR 5: Update docs (+ api docs if applicable)

### Goal
Align documentation with the new terminology.

### Tasks
- [ ] Update `README.md` terminology.
- [ ] Update `docs/*` terminology.
- [ ] Update ADR references if they describe renamed types as current.
- [ ] Do not edit `docs/api/*` (generated output).

### Done when
- No stale terminology in primary docs.
- Links to renamed API docs (if any) remain valid.

### Files
- `README.md`
- `docs/*`


### Quick manual test
1. Open `README.md` and verify terminology is consistent.
2. Click a couple of internal doc links to ensure they still resolve.

---

## [ ] PR 6: Hardening and final validation

### Goal
Close out Phase 3.7 with an AC-driven validation pass and clean-up searches.

### Tasks
- [ ] Run repository-wide searches to confirm no old type names remain (except explicit shims if chosen):
  - [ ] `MotorDefinition`
  - [ ] `CurveSeries`
  - [ ] `DriveConfiguration`
  - [ ] `VoltageConfiguration`
- [ ] Verify there were no accidental JSON contract changes:
  - [ ] Load + save an existing file and inspect (spot-check) that the structure and property names are unchanged.
- [ ] Ensure build/tests are green:
  - [ ] Build `src/MotorDefinition`
  - [ ] Build `src/MotorEditor.Avalonia`
  - [ ] Run `dotnet test`

### Done when
- All acceptance criteria for Phase 3.7 pass in a manual validation pass.

### Final manual validation script (AC-driven)
1. AC 3.7.2 / AC 3.7.3: Launch app; open `schema/example-motor.json`; verify drives/voltages/curves render.
2. AC 3.7.3: Perform one motor-property edit and one curve-table edit; verify Ctrl+Z/Ctrl+Y work.
3. AC 3.7.2: Save As to a new file; re-open; confirm no validation errors and curves still display.
4. AC 3.7.4: Run `dotnet test` and confirm green.
5. AC 3.7.1 / AC 3.7.5: Repo-wide search for old names returns no hits in code/docs (or only explicit shims).

### Sign-off checklist

- [ ] All tasks across all PR sections are checked `[x]`.
- [ ] All acceptance criteria listed above have a verification step (test or manual script).
- [ ] No out-of-scope features were implemented.
