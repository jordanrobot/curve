<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:CurveEditor.ViewModels"
        xmlns:views="using:CurveEditor.Views"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
        x:Class="CurveEditor.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="{Binding WindowTitle}"
        Width="1200" Height="800"
        MinWidth="800" MinHeight="600">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>
    
    <!-- Keyboard Shortcuts -->
    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+N" Command="{Binding NewMotorCommand}"/>
        <KeyBinding Gesture="Ctrl+O" Command="{Binding OpenFileCommand}"/>
        <KeyBinding Gesture="Ctrl+S" Command="{Binding SaveCommand}"/>
        <KeyBinding Gesture="Ctrl+Shift+S" Command="{Binding SaveAsCommand}"/>
    </Window.KeyBindings>
    
    <Window.Styles>
        <!-- Collapsible Header Style -->
        <Style Selector="ToggleButton.CollapsibleHeader">
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseLowBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        
        <!-- Property Label Style -->
        <Style Selector="TextBlock.PropertyLabel">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
            <Setter Property="Margin" Value="0,0,4,0"/>
            <Setter Property="MinWidth" Value="85"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        
        <!-- Property Value Style -->
        <Style Selector="TextBlock.PropertyValue">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        
        <!-- Property Input Style -->
        <Style Selector="TextBox.PropertyInput">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="MinHeight" Value="24"/>
        </Style>
        
        <!-- Property ComboBox Style -->
        <Style Selector="ComboBox.PropertyComboBox">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="MinHeight" Value="24"/>
        </Style>
        
        <!-- Property Row Style -->
        <Style Selector="Grid.PropertyRow">
            <Setter Property="Margin" Value="0,1"/>
        </Style>
        
        <!-- GridSplitter Style -->
        <Style Selector="GridSplitter">
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumBrush}"/>
        </Style>
    </Window.Styles>

    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File">
                <MenuItem Header="_New" Command="{Binding NewMotorCommand}" InputGesture="Ctrl+N"/>
                <MenuItem Header="_Open..." Command="{Binding OpenFileCommand}" InputGesture="Ctrl+O"/>
                <Separator/>
                <MenuItem Header="_Save" Command="{Binding SaveCommand}" InputGesture="Ctrl+S"/>
                <MenuItem Header="Save _As..." Command="{Binding SaveAsCommand}" InputGesture="Ctrl+Shift+S"/>
                <MenuItem Header="Save Copy As..." Command="{Binding SaveCopyAsCommand}"/>
                <Separator/>
                <MenuItem Header="E_xit" Command="{Binding ExitCommand}" InputGesture="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="_Undo" IsEnabled="False" InputGesture="Ctrl+Z"/>
                <MenuItem Header="_Redo" IsEnabled="False" InputGesture="Ctrl+Y"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="Show _Grid Lines" IsEnabled="False"/>
                <MenuItem Header="Show _Hover Tooltip" IsEnabled="False"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About" IsEnabled="False"/>
            </MenuItem>
        </Menu>

        <!-- Status Bar -->
        <Border DockPanel.Dock="Bottom" 
                Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                Padding="8,4">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Grid.Column="0"
                           Text="{Binding StatusMessage}" 
                           FontSize="12"
                           VerticalAlignment="Center"/>
                <!-- Validation Error Indicator -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="4"
                            IsVisible="{Binding HasValidationErrors}">
                    <TextBlock Text="âš ï¸"
                               FontSize="12"
                               VerticalAlignment="Center"/>
                    <TextBlock Text="Validation errors"
                               Foreground="Orange"
                               FontSize="12"
                               VerticalAlignment="Center"
                               ToolTip.Tip="{Binding ValidationErrors}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Area with resizable panels -->
        <Grid ColumnDefinitions="200,4,*,4,280">
            
            <!-- Left: Directory Browser (placeholder) -->
            <Border Grid.Column="0" 
                    BorderBrush="{DynamicResource SystemControlBackgroundBaseMediumBrush}"
                    BorderThickness="0,0,1,0"
                    Padding="8">
                <StackPanel>
                    <TextBlock Text="Directory Browser" 
                               FontWeight="Bold" 
                               Margin="0,0,0,8"/>
                    <TextBlock Text="(Coming Soon)" 
                               Foreground="Gray"
                               FontStyle="Italic"/>
                    <Button Content="Open Folder..." 
                            Margin="0,8,0,0"
                            HorizontalAlignment="Stretch"
                            IsEnabled="False"/>
                </StackPanel>
            </Border>
            
            <!-- Left GridSplitter -->
            <GridSplitter Grid.Column="1" Width="4" ResizeDirection="Columns"/>

            <!-- Center: Chart Area and Collapsible Data Panel -->
            <Grid Grid.Column="2" RowDefinitions="*,Auto,Auto">
                <!-- Chart Area -->
                <Border Grid.Row="0"
                        Margin="4"
                        BorderBrush="{DynamicResource SystemControlBackgroundBaseMediumBrush}"
                        BorderThickness="1"
                        CornerRadius="4">
                    <Grid>
                        <!-- Welcome screen when no motor loaded -->
                        <StackPanel VerticalAlignment="Center" 
                                    HorizontalAlignment="Center"
                                    IsVisible="{Binding CurrentMotor, Converter={x:Static ObjectConverters.IsNull}}">
                            <TextBlock Text="Motor Torque Curve Editor" 
                                       FontSize="24" 
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center"/>
                            <TextBlock Text="Create a new motor definition or open an existing file to get started."
                                       Margin="0,16,0,0"
                                       Foreground="Gray"
                                       HorizontalAlignment="Center"/>
                            <StackPanel Orientation="Horizontal" 
                                        HorizontalAlignment="Center" 
                                        Margin="0,24,0,0"
                                        Spacing="16">
                                <Button Content="New Motor" 
                                        Command="{Binding NewMotorCommand}"
                                        Padding="16,8"/>
                                <Button Content="Open File" 
                                        Command="{Binding OpenFileCommand}"
                                        Padding="16,8"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Chart when motor is loaded -->
                        <views:ChartView DataContext="{Binding ChartViewModel}"
                                         IsVisible="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).CurrentMotor, Converter={x:Static ObjectConverters.IsNotNull}}"/>
                    </Grid>
                </Border>
                
                <!-- Vertical GridSplitter between chart and data table -->
                <GridSplitter Grid.Row="1" 
                              Height="4" 
                              ResizeDirection="Rows"
                              IsVisible="{Binding IsCurveDataExpanded}"/>
                
                <!-- Collapsible Curve Data Panel -->
                <Border Grid.Row="2"
                        Margin="4,0,4,4"
                        BorderBrush="{DynamicResource SystemControlBackgroundBaseMediumBrush}"
                        BorderThickness="1"
                        CornerRadius="4"
                        IsVisible="{Binding CurrentMotor, Converter={x:Static ObjectConverters.IsNotNull}}">
                    <Grid RowDefinitions="Auto,*">
                        <!-- Collapsible Header -->
                        <ToggleButton Grid.Row="0" 
                                      IsChecked="{Binding IsCurveDataExpanded}"
                                      Classes="CollapsibleHeader">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="â–¶" FontSize="10" VerticalAlignment="Center"
                                           IsVisible="{Binding !IsCurveDataExpanded}"/>
                                <TextBlock Text="â–¼" FontSize="10" VerticalAlignment="Center"
                                           IsVisible="{Binding IsCurveDataExpanded}"/>
                                <TextBlock Text="Curve Data" FontWeight="Bold" FontSize="12"/>
                                <TextBlock Text="{Binding SelectedSeries.Name, StringFormat='- {0}'}"
                                           FontSize="11" Foreground="Gray"
                                           IsVisible="{Binding SelectedSeries, Converter={x:Static ObjectConverters.IsNotNull}}"/>
                            </StackPanel>
                        </ToggleButton>
                        
                        <!-- Data Content -->
                        <Border Grid.Row="1" 
                                IsVisible="{Binding IsCurveDataExpanded}"
                                MaxHeight="200">
                            <views:CurveDataPanel DataContext="{Binding}"/>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
            
            <!-- Right GridSplitter -->
            <GridSplitter Grid.Column="3" Width="4" ResizeDirection="Columns"/>

            <!-- Right: Properties Panel -->
            <Border Grid.Column="4" 
                    BorderBrush="{DynamicResource SystemControlBackgroundBaseMediumBrush}"
                    BorderThickness="1,0,0,0">
                <ScrollViewer>
                    <StackPanel Margin="6" 
                                IsVisible="{Binding CurrentMotor, Converter={x:Static ObjectConverters.IsNotNull}}">
                        
                        <TextBlock Text="Motor Properties" 
                                   FontWeight="Bold" 
                                   FontSize="14"
                                   Margin="0,0,0,6"/>
                        
                        <!-- Motor Name -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Motor Name" Classes="PropertyLabel"/>
                            <TextBox Grid.Column="1" Text="{Binding CurrentMotor.MotorName}" Classes="PropertyInput"/>
                        </Grid>
                        
                        <!-- Manufacturer -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Manufacturer" Classes="PropertyLabel"/>
                            <TextBox Grid.Column="1" Text="{Binding CurrentMotor.Manufacturer}" Classes="PropertyInput"/>
                        </Grid>
                        
                        <!-- Part Number -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Part Number" Classes="PropertyLabel"/>
                            <TextBox Grid.Column="1" Text="{Binding CurrentMotor.PartNumber}" Classes="PropertyInput"/>
                        </Grid>
                        
                        <!-- Max Speed -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Max Speed" Classes="PropertyLabel"/>
                            <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                <TextBox Grid.Column="0" Text="{Binding CurrentMotor.MaxSpeed}" Classes="PropertyInput"/>
                                <TextBlock Grid.Column="1" Text="RPM" Classes="PropertyValue" Margin="4,0,0,0"/>
                            </Grid>
                        </Grid>
                        
                        <!-- Rated Speed -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Rated Speed" Classes="PropertyLabel"/>
                            <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                <TextBox Grid.Column="0" Text="{Binding CurrentMotor.RatedSpeed}" Classes="PropertyInput"/>
                                <TextBlock Grid.Column="1" Text="RPM" Classes="PropertyValue" Margin="4,0,0,0"/>
                            </Grid>
                        </Grid>
                        
                        <!-- Peak Torque -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Peak Torque" Classes="PropertyLabel"/>
                            <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                <TextBox Grid.Column="0" Text="{Binding CurrentMotor.RatedPeakTorque}" Classes="PropertyInput"/>
                                <TextBlock Grid.Column="1" Text="{Binding CurrentMotor.Units.Torque}" Classes="PropertyValue" Margin="4,0,0,0"/>
                            </Grid>
                        </Grid>
                        
                        <!-- Cont. Torque -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Cont. Torque" Classes="PropertyLabel"/>
                            <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                <TextBox Grid.Column="0" Text="{Binding CurrentMotor.RatedContinuousTorque}" Classes="PropertyInput"/>
                                <TextBlock Grid.Column="1" Text="{Binding CurrentMotor.Units.Torque}" Classes="PropertyValue" Margin="4,0,0,0"/>
                            </Grid>
                        </Grid>
                        
                        <!-- Power -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Power" Classes="PropertyLabel"/>
                            <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                <TextBox Grid.Column="0" Text="{Binding CurrentMotor.Power}" Classes="PropertyInput"/>
                                <TextBlock Grid.Column="1" Text="{Binding CurrentMotor.Units.Power}" Classes="PropertyValue" Margin="4,0,0,0"/>
                            </Grid>
                        </Grid>
                        
                        <!-- Weight -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Weight" Classes="PropertyLabel"/>
                            <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                <TextBox Grid.Column="0" Text="{Binding CurrentMotor.Weight}" Classes="PropertyInput"/>
                                <TextBlock Grid.Column="1" Text="{Binding CurrentMotor.Units.Weight}" Classes="PropertyValue" Margin="4,0,0,0"/>
                            </Grid>
                        </Grid>
                        
                        <!-- Rotor Inertia -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Rotor Inertia" Classes="PropertyLabel"/>
                            <TextBox Grid.Column="1" Text="{Binding CurrentMotor.RotorInertia}" Classes="PropertyInput"/>
                        </Grid>
                        
                        <!-- Feedback PPR -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Feedback PPR" Classes="PropertyLabel"/>
                            <TextBox Grid.Column="1" Text="{Binding CurrentMotor.FeedbackPpr}" Classes="PropertyInput"/>
                        </Grid>
                        
                        <!-- Has Brake (Checkbox) -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Has Brake" Classes="PropertyLabel"/>
                            <CheckBox Grid.Column="1" IsChecked="{Binding CurrentMotor.HasBrake}" VerticalAlignment="Center"/>
                        </Grid>
                        
                        <!-- Brake Torque -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Brake Torque" Classes="PropertyLabel"/>
                            <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                <TextBox Grid.Column="0" Text="{Binding CurrentMotor.BrakeTorque}" Classes="PropertyInput"/>
                                <TextBlock Grid.Column="1" Text="{Binding CurrentMotor.Units.Torque}" Classes="PropertyValue" Margin="4,0,0,0"/>
                            </Grid>
                        </Grid>
                        
                        <!-- Brake Amperage -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Brake Amps" Classes="PropertyLabel"/>
                            <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                <TextBox Grid.Column="0" Text="{Binding CurrentMotor.BrakeAmperage}" Classes="PropertyInput"/>
                                <TextBlock Grid.Column="1" Text="A" Classes="PropertyValue" Margin="4,0,0,0"/>
                            </Grid>
                        </Grid>
                        
                        <!-- Brake Voltage -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" Text="Brake Voltage" Classes="PropertyLabel"/>
                            <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                <TextBox Grid.Column="0" Text="{Binding CurrentMotor.BrakeVoltage}" Classes="PropertyInput"/>
                                <TextBlock Grid.Column="1" Text="V" Classes="PropertyValue" Margin="4,0,0,0"/>
                            </Grid>
                        </Grid>
                        
                        <!-- UNITS SECTION (Collapsible) -->
                        <ToggleButton IsChecked="{Binding IsUnitsExpanded}"
                                      Classes="CollapsibleHeader"
                                      Margin="0,8,0,0">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="â–¶" FontSize="10" VerticalAlignment="Center"
                                           IsVisible="{Binding !IsUnitsExpanded}"/>
                                <TextBlock Text="â–¼" FontSize="10" VerticalAlignment="Center"
                                           IsVisible="{Binding IsUnitsExpanded}"/>
                                <TextBlock Text="Units" FontWeight="SemiBold" FontSize="12"/>
                            </StackPanel>
                        </ToggleButton>
                        
                        <StackPanel IsVisible="{Binding IsUnitsExpanded}" Margin="0,4,0,0">
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Torque" Classes="PropertyLabel"/>
                                <ComboBox Grid.Column="1" 
                                          ItemsSource="{Binding TorqueUnits}"
                                          SelectedItem="{Binding CurrentMotor.Units.Torque}"
                                          Classes="PropertyComboBox"/>
                            </Grid>
                            
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Speed" Classes="PropertyLabel"/>
                                <ComboBox Grid.Column="1" 
                                          ItemsSource="{Binding SpeedUnits}"
                                          SelectedItem="{Binding CurrentMotor.Units.Speed}"
                                          Classes="PropertyComboBox"/>
                            </Grid>
                            
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Power" Classes="PropertyLabel"/>
                                <ComboBox Grid.Column="1" 
                                          ItemsSource="{Binding PowerUnits}"
                                          SelectedItem="{Binding CurrentMotor.Units.Power}"
                                          Classes="PropertyComboBox"/>
                            </Grid>
                            
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Weight" Classes="PropertyLabel"/>
                                <ComboBox Grid.Column="1" 
                                          ItemsSource="{Binding WeightUnits}"
                                          SelectedItem="{Binding CurrentMotor.Units.Weight}"
                                          Classes="PropertyComboBox"/>
                            </Grid>
                            
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Voltage" Classes="PropertyLabel"/>
                                <ComboBox Grid.Column="1" 
                                          ItemsSource="{Binding VoltageUnits}"
                                          SelectedItem="{Binding CurrentMotor.Units.Voltage}"
                                          Classes="PropertyComboBox"/>
                            </Grid>
                            
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Current" Classes="PropertyLabel"/>
                                <ComboBox Grid.Column="1" 
                                          ItemsSource="{Binding CurrentUnits}"
                                          SelectedItem="{Binding CurrentMotor.Units.Current}"
                                          Classes="PropertyComboBox"/>
                            </Grid>
                            
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Inertia" Classes="PropertyLabel"/>
                                <ComboBox Grid.Column="1" 
                                          ItemsSource="{Binding InertiaUnits}"
                                          SelectedItem="{Binding CurrentMotor.Units.Inertia}"
                                          Classes="PropertyComboBox"/>
                            </Grid>
                            
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Torque Const." Classes="PropertyLabel"/>
                                <ComboBox Grid.Column="1" 
                                          ItemsSource="{Binding TorqueConstantUnits}"
                                          SelectedItem="{Binding CurrentMotor.Units.TorqueConstant}"
                                          Classes="PropertyComboBox"/>
                            </Grid>
                            
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Backlash" Classes="PropertyLabel"/>
                                <ComboBox Grid.Column="1" 
                                          ItemsSource="{Binding BacklashUnits}"
                                          SelectedItem="{Binding CurrentMotor.Units.Backlash}"
                                          Classes="PropertyComboBox"/>
                            </Grid>
                        </StackPanel>
                        
                        <!-- DRIVE PROPERTIES SECTION -->
                        <TextBlock Text="Drive Properties" 
                                   FontWeight="SemiBold" 
                                   FontSize="12"
                                   Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                                   Padding="4,4"
                                   Margin="-6,8,-6,4"/>
                        
                        <!-- Drive Selection ComboBox with + and trash buttons -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*,Auto,Auto">
                            <TextBlock Grid.Column="0" Text="Drive" Classes="PropertyLabel"/>
                            <ComboBox Grid.Column="1" 
                                      ItemsSource="{Binding AvailableDrives}"
                                      SelectedItem="{Binding SelectedDrive}"
                                      Classes="PropertyComboBox">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <Button Grid.Column="2" 
                                    Width="24" Height="24" 
                                    Padding="0" 
                                    Margin="4,0,0,0"
                                    Command="{Binding AddDriveCommand}"
                                    ToolTip.Tip="Add new drive"
                                    HorizontalContentAlignment="Center"
                                    VerticalContentAlignment="Center">
                                <TextBlock Text="+" FontSize="14" FontWeight="Bold"/>
                            </Button>
                            <Button Grid.Column="3" 
                                    Width="24" Height="24" 
                                    Padding="0" 
                                    Margin="4,0,0,0"
                                    Command="{Binding RemoveDriveCommand}"
                                    ToolTip.Tip="Delete selected drive"
                                    HorizontalContentAlignment="Center"
                                    VerticalContentAlignment="Center">
                                <TextBlock Text="ðŸ—‘" FontSize="12"/>
                            </Button>
                        </Grid>
                        
                        <!-- Voltage Selection ComboBox with + and trash buttons (directly under Drive) -->
                        <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*,Auto,Auto">
                            <TextBlock Grid.Column="0" Text="Voltage" Classes="PropertyLabel"/>
                            <ComboBox Grid.Column="1" 
                                      ItemsSource="{Binding AvailableVoltages}"
                                      SelectedItem="{Binding SelectedVoltage}"
                                      Classes="PropertyComboBox">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Voltage, StringFormat={}{0}V}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <Button Grid.Column="2" 
                                    Width="24" Height="24" 
                                    Padding="0" 
                                    Margin="4,0,0,0"
                                    Command="{Binding AddVoltageCommand}"
                                    ToolTip.Tip="Add new voltage"
                                    HorizontalContentAlignment="Center"
                                    VerticalContentAlignment="Center">
                                <TextBlock Text="+" FontSize="14" FontWeight="Bold"/>
                            </Button>
                            <Button Grid.Column="3" 
                                    Width="24" Height="24" 
                                    Padding="0" 
                                    Margin="4,0,0,0"
                                    Command="{Binding RemoveVoltageCommand}"
                                    ToolTip.Tip="Delete selected voltage"
                                    HorizontalContentAlignment="Center"
                                    VerticalContentAlignment="Center">
                                <TextBlock Text="ðŸ—‘" FontSize="12"/>
                            </Button>
                        </Grid>
                        
                        <!-- Selected Drive Properties -->
                        <StackPanel IsVisible="{Binding SelectedDrive, Converter={x:Static ObjectConverters.IsNotNull}}">
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Drive Name" Classes="PropertyLabel"/>
                                <TextBox Grid.Column="1" Text="{Binding SelectedDrive.Name, Mode=TwoWay}" Classes="PropertyInput"/>
                            </Grid>
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Part Number" Classes="PropertyLabel"/>
                                <TextBox Grid.Column="1" Text="{Binding SelectedDrive.PartNumber}" Classes="PropertyInput"/>
                            </Grid>
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Manufacturer" Classes="PropertyLabel"/>
                                <TextBox Grid.Column="1" Text="{Binding SelectedDrive.Manufacturer}" Classes="PropertyInput"/>
                            </Grid>
                            
                            <!-- Selected Voltage Properties -->
                            <StackPanel IsVisible="{Binding SelectedVoltage, Converter={x:Static ObjectConverters.IsNotNull}}">
                                <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                    <TextBlock Grid.Column="0" Text="Voltage" Classes="PropertyLabel"/>
                                    <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding SelectedVoltage.Voltage}" Classes="PropertyInput"/>
                                        <TextBlock Grid.Column="1" Text="{Binding CurrentMotor.Units.Voltage}" Classes="PropertyValue" Margin="4,0,0,0"/>
                                    </Grid>
                                </Grid>
                                <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                    <TextBlock Grid.Column="0" Text="Power" Classes="PropertyLabel"/>
                                    <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding SelectedVoltage.Power}" Classes="PropertyInput"/>
                                        <TextBlock Grid.Column="1" Text="{Binding CurrentMotor.Units.Power}" Classes="PropertyValue" Margin="4,0,0,0"/>
                                    </Grid>
                                </Grid>
                                <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                    <TextBlock Grid.Column="0" Text="Max Speed" Classes="PropertyLabel"/>
                                    <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding SelectedVoltage.MaxSpeed}" Classes="PropertyInput" LostFocus="OnMaxSpeedLostFocus"/>
                                        <TextBlock Grid.Column="1" Text="{Binding CurrentMotor.Units.Speed}" Classes="PropertyValue" Margin="4,0,0,0"/>
                                    </Grid>
                                </Grid>
                                <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                    <TextBlock Grid.Column="0" Text="Peak Torque" Classes="PropertyLabel"/>
                                    <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding SelectedVoltage.RatedPeakTorque}" Classes="PropertyInput"/>
                                        <TextBlock Grid.Column="1" Text="{Binding CurrentMotor.Units.Torque}" Classes="PropertyValue" Margin="4,0,0,0"/>
                                    </Grid>
                                </Grid>
                                <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                    <TextBlock Grid.Column="0" Text="Cont. Torque" Classes="PropertyLabel"/>
                                    <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding SelectedVoltage.RatedContinuousTorque}" Classes="PropertyInput"/>
                                        <TextBlock Grid.Column="1" Text="{Binding CurrentMotor.Units.Torque}" Classes="PropertyValue" Margin="4,0,0,0"/>
                                    </Grid>
                                </Grid>
                                <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                    <TextBlock Grid.Column="0" Text="Cont. Amps" Classes="PropertyLabel"/>
                                    <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding SelectedVoltage.ContinuousAmperage}" Classes="PropertyInput"/>
                                        <TextBlock Grid.Column="1" Text="{Binding CurrentMotor.Units.Current}" Classes="PropertyValue" Margin="4,0,0,0"/>
                                    </Grid>
                                </Grid>
                                <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                    <TextBlock Grid.Column="0" Text="Peak Amps" Classes="PropertyLabel"/>
                                    <Grid Grid.Column="1" ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding SelectedVoltage.PeakAmperage}" Classes="PropertyInput"/>
                                        <TextBlock Grid.Column="1" Text="{Binding CurrentMotor.Units.Current}" Classes="PropertyValue" Margin="4,0,0,0"/>
                                    </Grid>
                                </Grid>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- CURVE SERIES SECTION -->
                        <TextBlock Text="Curve Series" 
                                   FontWeight="SemiBold" 
                                   FontSize="12"
                                   Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                                   Padding="4,4"
                                   Margin="-6,8,-6,4"/>
                        
                        <!-- Series ListBox with visibility checkboxes and lock buttons -->
                        <ListBox ItemsSource="{Binding AvailableSeries}"
                                 SelectedItem="{Binding SelectedSeries}"
                                 MinHeight="50"
                                 MaxHeight="100"
                                 Margin="0,4,0,4">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="Auto,Auto,*">
                                        <!-- Visibility Checkbox -->
                                        <CheckBox Grid.Column="0"
                                                  IsChecked="{Binding IsVisible}"
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,4,0"
                                                  ToolTip.Tip="Toggle Visibility"
                                                  Command="{Binding $parent[ListBox].((vm:MainWindowViewModel)DataContext).ToggleSeriesVisibilityCommand}"
                                                  CommandParameter="{Binding}"/>
                                        <!-- Lock Button -->
                                        <Button Grid.Column="1" 
                                                Width="20" Height="20" 
                                                Padding="0" 
                                                Margin="0,0,4,0"
                                                Command="{Binding $parent[ListBox].((vm:MainWindowViewModel)DataContext).ToggleSeriesLockCommand}"
                                                CommandParameter="{Binding}"
                                                ToolTip.Tip="Toggle Lock">
                                            <Panel>
                                                <TextBlock Text="ðŸ”’" FontSize="10" IsVisible="{Binding Locked}"/>
                                                <TextBlock Text="ðŸ”“" FontSize="10" IsVisible="{Binding !Locked}"/>
                                            </Panel>
                                        </Button>
                                        <TextBlock Grid.Column="2" Text="{Binding Name}" VerticalAlignment="Center" FontSize="11"/>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                        
                        <Grid ColumnDefinitions="*,Auto">
                            <Button Grid.Column="0" 
                                    HorizontalAlignment="Stretch"
                                    Command="{Binding AddSeriesCommand}"
                                    Padding="4,2"
                                    ToolTip.Tip="Add new series"
                                    HorizontalContentAlignment="Center">
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="+" FontWeight="Bold"/>
                                    <TextBlock Text="Add Series"/>
                                </StackPanel>
                            </Button>
                            <Button Grid.Column="1" 
                                    Width="24" Height="24" 
                                    Padding="0" 
                                    Margin="4,0,0,0"
                                    Command="{Binding RemoveSeriesCommand}"
                                    ToolTip.Tip="Delete selected series"
                                    HorizontalContentAlignment="Center"
                                    VerticalContentAlignment="Center">
                                <TextBlock Text="ðŸ—‘" FontSize="12"/>
                            </Button>
                        </Grid>
                        
                        <!-- Selected Series Properties -->
                        <StackPanel IsVisible="{Binding SelectedSeries, Converter={x:Static ObjectConverters.IsNotNull}}"
                                    Margin="0,4,0,0">
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Name" Classes="PropertyLabel"/>
                                <TextBox Grid.Column="1" Text="{Binding SelectedSeries.Name}" Classes="PropertyInput"/>
                            </Grid>
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Locked" Classes="PropertyLabel"/>
                                <CheckBox Grid.Column="1" IsChecked="{Binding SelectedSeries.Locked}" VerticalAlignment="Center"/>
                            </Grid>
                            <Grid Classes="PropertyRow" ColumnDefinitions="Auto,*">
                                <TextBlock Grid.Column="0" Text="Notes" Classes="PropertyLabel"/>
                                <TextBox Grid.Column="1" Text="{Binding SelectedSeries.Notes}" Classes="PropertyInput" 
                                         AcceptsReturn="True" TextWrapping="Wrap" MinHeight="40"/>
                            </Grid>
                        </StackPanel>
                        
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>
    </DockPanel>

</Window>
